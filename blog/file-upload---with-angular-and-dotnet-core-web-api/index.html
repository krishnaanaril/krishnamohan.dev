<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Scully 0.0.0">
  <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118442837-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-118442837-2');
  </script>
  <meta charset="utf-8">
  <title>File Upload - With Angular and Dotnet Core Web API</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
  <link rel="manifest" href="manifest.json">  
  <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">
  <meta name="theme-color" content="#1976d2">
<link rel="stylesheet" href="styles.ebda5ec8c0c5f26dcbd1.css"><style></style><style>.cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}
</style><script charset="utf-8" src="common-es2015.e045a09f09ef3032a2b3.js"></script><script charset="utf-8" src="6-es2015.23f11d2b859321b57fa8.js"></script><style>[_ngcontent-psr-c26]::slotted(h1){color:#330625;background-color:#f8d3ec;padding:5px;border-radius:5px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.blog-post[_ngcontent-psr-c26], .post-footer[_ngcontent-psr-c26]{margin:auto;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;max-width:768px;font-size:18px;line-height:1.5;font-family:Raleway,sans-serif}@media (max-width:768px){.blog-post[_ngcontent-psr-c26], .post-footer[_ngcontent-psr-c26]{margin:0 10px}}pre[_ngcontent-psr-c26]{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;background-color:rgba(0,0,0,.05);padding:20px}pre[_ngcontent-psr-c26]   code[_ngcontent-psr-c26]{background-color:transparent}code[_ngcontent-psr-c26]{background-color:rgba(0,0,0,.05);padding:2px 4px;white-space:break-spaces;word-break:break-word}.blog-title[_ngcontent-psr-c26]{font-weight:400;font-size:4.5rem;line-height:1;word-break:normal;display:block;margin:0 auto 10px;text-align:center;font-family:Zilla Slab,serif}@media (max-width:768px){.blog-title[_ngcontent-psr-c26]{font-size:3rem}}hr[_ngcontent-psr-c26]{width:100px}.sub-items-container[_ngcontent-psr-c26], mat-chip-list[_ngcontent-psr-c26]{display:flex;justify-content:center}mat-chip-list[_ngcontent-psr-c26]{margin:50px auto 5px}.keywords[_ngcontent-psr-c26]{background-color:#f5f5f5;padding:10px;border:1px solid grey}</style><meta name="title" content="File Upload - With Angular and Dotnet Core Web API"><meta name="description" content="blog description"><meta name="og:type" content="website"><meta name="og:url" content="/blog/file-upload---with-angular-and-dotnet-core-web-api"><meta name="og:title" content="File Upload - With Angular and Dotnet Core Web API"><meta name="og:description" content="blog description"><meta name="og:image" content=""><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="/blog/file-upload---with-angular-and-dotnet-core-web-api"><meta name="twitter:title" content="File Upload - With Angular and Dotnet Core Web API"><meta name="twitter:description" content="blog description"><meta name="twitter:image" content=""><meta name="twitter:site" content="@krishnaanaril"><meta name="twitter:creator" content="@krishnaanaril"><meta name="keywords" content="angular, dotnet, API"><style>.mat-chip{position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;transform:translateZ(0);border:none;-webkit-appearance:none;-moz-appearance:none}.mat-standard-chip{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:inline-flex;padding:7px 12px;border-radius:16px;align-items:center;cursor:default;min-height:32px;height:1px}._mat-animation-noopable.mat-standard-chip{transition:none;animation:none}.mat-standard-chip .mat-chip-remove.mat-icon{width:18px;height:18px}.mat-standard-chip::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;opacity:0;content:"";pointer-events:none;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-standard-chip:hover::after{opacity:.12}.mat-standard-chip:focus{outline:none}.mat-standard-chip:focus::after{opacity:.16}.cdk-high-contrast-active .mat-standard-chip{outline:solid 1px}.cdk-high-contrast-active .mat-standard-chip:focus{outline:dotted 2px}.mat-standard-chip.mat-chip-disabled::after{opacity:0}.mat-standard-chip.mat-chip-disabled .mat-chip-remove,.mat-standard-chip.mat-chip-disabled .mat-chip-trailing-icon{cursor:default}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar,.mat-standard-chip.mat-chip-with-avatar{padding-top:0;padding-bottom:0}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-right:8px;padding-left:0}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-left:8px;padding-right:0}.mat-standard-chip.mat-chip-with-trailing-icon{padding-top:7px;padding-bottom:7px;padding-right:8px;padding-left:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon{padding-left:8px;padding-right:12px}.mat-standard-chip.mat-chip-with-avatar{padding-left:0;padding-right:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-avatar{padding-right:0;padding-left:12px}.mat-standard-chip .mat-chip-avatar{width:24px;height:24px;margin-right:8px;margin-left:4px}[dir=rtl] .mat-standard-chip .mat-chip-avatar{margin-left:8px;margin-right:4px}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{width:18px;height:18px;cursor:pointer}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-standard-chip .mat-chip-remove,[dir=rtl] .mat-standard-chip .mat-chip-trailing-icon{margin-right:8px;margin-left:0}.mat-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit;overflow:hidden}.mat-chip-list-wrapper{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;margin:-4px}.mat-chip-list-wrapper input.mat-input-element,.mat-chip-list-wrapper .mat-standard-chip{margin:4px}.mat-chip-list-stacked .mat-chip-list-wrapper{flex-direction:column;align-items:flex-start}.mat-chip-list-stacked .mat-chip-list-wrapper .mat-standard-chip{width:100%}.mat-chip-avatar{border-radius:50%;justify-content:center;align-items:center;display:flex;overflow:hidden;object-fit:cover}input.mat-chip-input{width:150px;margin:4px;flex:1 0 150px}
</style><style>
      :host {
        display: none;
      }
      scully-content {
        display: none;
      }
    </style><script>window['ScullyIO']='generated';</script></head>

<body scully-version="0.0.0">
  <app-root _nghost-psr-c13="" ng-version="11.0.2"><mat-toolbar _ngcontent-psr-c13="" class="mat-toolbar tool-bar mat-toolbar-single-row"><nav _ngcontent-psr-c13=""><ul _ngcontent-psr-c13="" class="top-nav"><li _ngcontent-psr-c13="" routerlink="/" routerlinkactive="nav-active" tabindex="0">Home</li><li _ngcontent-psr-c13="">Blog</li><li _ngcontent-psr-c13="">Projects</li><li _ngcontent-psr-c13="">About</li></ul></nav></mat-toolbar><router-outlet _ngcontent-psr-c13=""></router-outlet><app-blog _nghost-psr-c26=""><div _ngcontent-psr-c26="" class="blog-post">
    <div _ngcontent-psr-c26="" class="title-section">
        <mat-chip-list _ngcontent-psr-c26="" aria-label="Blog tags/keywords" class="mat-chip-list" id="mat-chip-list-0" tabindex="0" aria-required="false" aria-disabled="false" aria-invalid="false" aria-multiselectable="false" role="listbox" aria-orientation="horizontal"><div class="mat-chip-list-wrapper">
            <mat-chip _ngcontent-psr-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>angular</mat-chip><mat-chip _ngcontent-psr-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>dotnet</mat-chip><mat-chip _ngcontent-psr-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>API</mat-chip><!---->
        </div></mat-chip-list>
        <h1 _ngcontent-psr-c26="" class="blog-title">File Upload - With Angular and Dotnet Core Web API</h1>
        <div _ngcontent-psr-c26="" class="sub-items-container">
            <time _ngcontent-psr-c26="">Sep 2, 2020</time>
        </div>
    </div>
    <hr _ngcontent-psr-c26="">
    <!--scullyContent-begin--><h1 id="file-upload---with-angular-and-dotnet-core-web-api" _ngcontent-psr-c26="">File Upload - With Angular and Dotnet Core Web API</h1>
<p _ngcontent-psr-c26="">In this blog post we'll have a minimal implementation of file upload using <a href="https://angular.io" _ngcontent-psr-c26="">Angular</a> and dotnet core web API. No other fancy stuffs. To completely understand the gist,some familiarity with Angular and dotnet core is required.</p>
<h2 id="contents" _ngcontent-psr-c26="">Contents</h2>
<ol _ngcontent-psr-c26="">
<li _ngcontent-psr-c26=""><a href="" _ngcontent-psr-c26="">Prerequisite</a></li>
<li _ngcontent-psr-c26=""><a href="" _ngcontent-psr-c26="">Creating Web API</a></li>
<li _ngcontent-psr-c26=""><a href="" _ngcontent-psr-c26="">Creating Angular Frontend</a></li>
<li _ngcontent-psr-c26=""><a href="" _ngcontent-psr-c26="">What's next</a></li>
</ol>
<h2 id="prerequisite" _ngcontent-psr-c26="">Prerequisite</h2>
<ul _ngcontent-psr-c26="">
<li _ngcontent-psr-c26="">Install <a href="https://angular.io/cli#installing-angular-cli" _ngcontent-psr-c26="">Angular CLI</a></li>
<li _ngcontent-psr-c26="">Install <a href="https://dotnet.microsoft.com/download/dotnet-core/3.1" _ngcontent-psr-c26="">Dotnet Core</a>. For this post I'll be using dotnet core version 3.1.</li>
</ul>
<h2 id="creating-web-api" _ngcontent-psr-c26="">Creating Web API</h2>
<p _ngcontent-psr-c26="">First we need to create a <a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api?view=aspnetcore-3.1&amp;tabs=visual-studio-code#create-a-web-project" _ngcontent-psr-c26="">dotnet core web api project</a> and then add <code _ngcontent-psr-c26="">FileUploadController</code> <a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api?view=aspnetcore-3.1&amp;tabs=visual-studio-code#create-a-web-project" _ngcontent-psr-c26="">Controller class</a></p>
<h3 id="add-serilog-for-logging-optional" _ngcontent-psr-c26="">Add Serilog for logging (Optional)</h3>
<p _ngcontent-psr-c26="">For logging I'll be using <a href="https://serilog.net/" _ngcontent-psr-c26="">Serilog</a> and a flat file sink. To configure this we need to install the following dependencies via Nuget. </p>
<ul _ngcontent-psr-c26="">
<li _ngcontent-psr-c26="">Serilog</li>
<li _ngcontent-psr-c26="">Serilog.AspNetCore</li>
<li _ngcontent-psr-c26="">Serilog.Sinks.file</li>
</ul>
<p _ngcontent-psr-c26="">Then update the <code _ngcontent-psr-c26="">Program.cs</code> file.</p>
<pre _ngcontent-psr-c26=""><code class="language-C#" _ngcontent-psr-c26="">    public class Program
    {
        public static void Main(string[] args)
        {
            Log.Logger = new LoggerConfiguration()
                .Enrich.FromLogContext()
                .WriteTo.File("logs/log-.txt", rollingInterval: RollingInterval.Day)
                .CreateLogger();
            try
            {
                Log.Information("app starting");
                CreateHostBuilder(args).Build().Run();
                Log.Information("app terminated");
            }
            catch (Exception e)
            {
                Log.Fatal("app crashed", e);
            }
            finally
            {
                Log.CloseAndFlush();
            }
        }

        public static IHostBuilder CreateHostBuilder(string[] args) =&gt;
            Host.CreateDefaultBuilder(args)
                .ConfigureWebHostDefaults(webBuilder =&gt;
                {
                    webBuilder.UseStartup&lt;Startup&gt;();
                })
                .UseSerilog();
    }</code></pre>
<p _ngcontent-psr-c26="">In <code _ngcontent-psr-c26="">FileUploadController.cs</code> file add the parameter <code _ngcontent-psr-c26="">ILogger&lt;FileUploadController&gt; logger</code> to the constructor.</p>
<pre _ngcontent-psr-c26=""><code class="language-C#" _ngcontent-psr-c26="">    private readonly ILogger&lt;FileUploadController&gt; _logger;

    public FileUploadController(ILogger&lt;FileUploadController&gt; logger)
    {
        _logger = logger;
    }</code></pre>
<h3 id="get-upload-path-from-configuration-optional" _ngcontent-psr-c26="">Get upload path from configuration (Optional)</h3>
<p _ngcontent-psr-c26="">If you need to have file upload path configurable, you can add the path as key-value pair in <code _ngcontent-psr-c26="">appsettings.json</code> file. e.g:</p>
<pre _ngcontent-psr-c26=""><code class="language-json" _ngcontent-psr-c26="">    "FileUploadPath": "C:\\KrishnaMohan\\Builds\\uploads"</code></pre>
<p _ngcontent-psr-c26="">And update <code _ngcontent-psr-c26="">FileUploadController.cs</code> constructor to add the configuration parameter.</p>
<pre _ngcontent-psr-c26=""><code class="language-C#" _ngcontent-psr-c26="">    private readonly IConfiguration _configuration;
    private readonly ILogger&lt;FileUploadController&gt; _logger;

    public FileUploadController(IConfiguration configuration, ILogger&lt;FileUploadController&gt; logger)
    {
        _configuration = configuration;
        _logger = logger;
    }</code></pre>
<h3 id="add-methods" _ngcontent-psr-c26="">Add methods</h3>
<p _ngcontent-psr-c26="">Let's add two methods to handle single file upload and multiple file upload. Argument for methods will be of type <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.iformfile?view=aspnetcore-3.1" _ngcontent-psr-c26="">IFormFile</a> which represent the file send with HttpRequest.</p>
<ul _ngcontent-psr-c26="">
<li _ngcontent-psr-c26=""><p _ngcontent-psr-c26="">POST Method for Single File Upload</p>
<pre _ngcontent-psr-c26=""><code class="language-C#" _ngcontent-psr-c26="">  [Route("single-file")]
  [HttpPost]
  public async Task&lt;IActionResult&gt; PostSingleFile(IFormFile formFile)
  {            
      long size = formFile.Length;        
      _logger.LogInformation($"Got {1} files");            
      if (formFile.Length &gt; 0)
      {
          var filePath = Path.Join(_configuration["FileUploadPath"], formFile.FileName);
          _logger.LogInformation($"File Name: {formFile.FileName}. File Path: {filePath}");

          using (var stream = System.IO.File.Create(filePath))
          {
              await formFile.CopyToAsync(stream);
          }
      }
      _logger.LogInformation("All files saved successfully");

      return Ok(new { count = 1, size });
  }</code></pre>
</li>
<li _ngcontent-psr-c26=""><p _ngcontent-psr-c26="">POST Method for Multiple File Upload</p>
<pre _ngcontent-psr-c26=""><code class="language-C#" _ngcontent-psr-c26="">  [Route("multiple-files")]
  [HttpPost]
  public async Task&lt;IActionResult&gt; PostMultipleFiles(List&lt;IFormFile&gt; files)
  {
      long size = files.Sum(f =&gt; f.Length);
      _logger.LogInformation($"Got {files.Count} files");
      foreach (var formFile in files)
      {
          if (formFile.Length &gt; 0)
          {
              var filePath = Path.Join(_configuration["FileUploadPath"], formFile.FileName);
              _logger.LogInformation($"File Name: {formFile.FileName}. File Path: {filePath}");

              using (var stream = System.IO.File.Create(filePath))
              {
                  await formFile.CopyToAsync(stream);
              }
          }
      }
      _logger.LogInformation("All files saved successfully");
      return Ok(new { count = files.Count, size });
  }</code></pre>
</li>
</ul>
<p _ngcontent-psr-c26="">And that's it. We are done with the API part.</p>
<h2 id="creating-angular-frontend" _ngcontent-psr-c26="">Creating Angular Frontend</h2>
<p _ngcontent-psr-c26="">Using Angular CLI create a <a href="https://angular.io/cli/new" _ngcontent-psr-c26="">new project</a> and add <code _ngcontent-psr-c26="">file-upload</code> <a href="https://angular.io/cli/generate#component" _ngcontent-psr-c26="">component</a> and <a href="https://angular.io/cli/generate#service" _ngcontent-psr-c26="">service</a>. The logic for getting the user selected files resides in the component and the logic for sending post request resides in the service.</p>
<ul _ngcontent-psr-c26="">
<li _ngcontent-psr-c26=""><p _ngcontent-psr-c26="">Update <code _ngcontent-psr-c26="">file-upload.service.ts</code> to add our methods to make the http request. Make sure that you import <a href="https://angular.io/api/common/http/HttpClientModule" _ngcontent-psr-c26="">HttpClientModule</a> in your module file. Here we'll be using <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" _ngcontent-psr-c26="">FormData</a> to send the file along with the request.</p>
<pre _ngcontent-psr-c26=""><code class="language-typescript" _ngcontent-psr-c26="">  constructor(private httpClient: HttpClient) { }

  postFile(filesToUpload: File): Observable&lt;boolean&gt; {
      const endpoint = 'https://localhost:44352/api/fileupload/single-file';
      const formData: FormData = new FormData();    
      formData.append('formFile', filesToUpload, filesToUpload.name);      
      return this.httpClient
      .post(endpoint, formData)
      .pipe(map(() =&gt; { return true; }));
  }

  postMultipleFiles(filesToUpload: FileList): Observable&lt;boolean&gt; {
      const endpoint = 'https://localhost:44352/api/fileupload/multiple-files';
      const formData: FormData = new FormData();
      Array.from(filesToUpload).forEach(file =&gt; {
      formData.append('files', file, file.name);  
      });    
      return this.httpClient
      .post(endpoint, formData)
      .pipe(map(() =&gt; { return true; }));
  }</code></pre>
</li>
<li _ngcontent-psr-c26=""><p _ngcontent-psr-c26="">Add the following methods in <code _ngcontent-psr-c26="">file-upload.component.ts</code> and update the constructor to add the service.</p>
<pre _ngcontent-psr-c26=""><code class="language-typescript" _ngcontent-psr-c26="">  export class FileUploadComponent {
      filesToUpload: FileList;
      constructor(private fileUploadService: FileUploadService){}

      filesChange($event) {    
          this.filesToUpload = $event.target.files;
      }

      uploadFiles() {    
          if(this.filesToUpload.length &gt; 1) {
          this.fileUploadService.postMultipleFiles(this.filesToUpload)
          .subscribe((res)=&gt; console.log(res));
          } else {
          this.fileUploadService.postFile(this.filesToUpload[0])
          .subscribe((res)=&gt; console.log(res));
          }
      }
  }</code></pre>
</li>
<li _ngcontent-psr-c26=""><p _ngcontent-psr-c26="">Update <code _ngcontent-psr-c26="">file-upload.component.html</code> to add the html inputs. Ideally we should use a form, but for simplicity I'm using button click event to trigger the upload. Also I've mentioned <code _ngcontent-psr-c26="">image/*</code> in the accept attribute to only allow image file types but this is optional.</p>
<pre _ngcontent-psr-c26=""><code class="language-html" _ngcontent-psr-c26="">  &lt;label for="file"&gt;Choose File&lt;/label&gt;
  &lt;input type="file" accept="image/*" multiple (change)="filesChange($event)"&gt;
  &lt;button type="button" (click)="uploadFiles()"&gt;{{'Upload' | uppercase}}&lt;/button&gt;</code></pre>
</li>
</ul>
<h2 id="testing" _ngcontent-psr-c26="">Testing</h2>
<ul _ngcontent-psr-c26="">
<li _ngcontent-psr-c26=""><a href="https://docs.microsoft.com/en-us/visualstudio/get-started/csharp/tutorial-aspnet-core-ef-step-02?view=vs-2019#run-the-application" _ngcontent-psr-c26="">Start the Web API</a> and Angular project (use <code _ngcontent-psr-c26="">npm start</code>). </li>
<li _ngcontent-psr-c26="">Navigate to <code _ngcontent-psr-c26="">http:/localhost:4200</code></li>
<li _ngcontent-psr-c26="">Select the files and click on <code _ngcontent-psr-c26="">Update</code>.</li>
<li _ngcontent-psr-c26="">Verify the files are uploaded to the configured folder.</li>
</ul>
<h2 id="whats-next" _ngcontent-psr-c26="">What's next</h2>
<p _ngcontent-psr-c26="">This a bare minimum code snippet which is not ideal for production envrionment. We can extend this with reactive forms and update the file to AWS S3 buckets. Well that is up for you. </p>
<!--scullyContent-end--><script>try {window['scullyContent'] = {cssId:"_ngcontent-psr-c26",html:document.body.innerHTML.split('<!--scullyContent-begin-->')[1].split('<!--scullyContent-end-->')[0]};} catch(e) {console.error('scully could not parse content');}</script><scully-content _ngcontent-psr-c26=""></scully-content>
    <hr _ngcontent-psr-c26="">
    <div _ngcontent-psr-c26="" class="post-footer">
        Have questions/comments? Tweet @<a _ngcontent-psr-c26="" href="https://twitter.com/krishnaanaril">krishnaanaril</a>
    </div>
</div><!----></app-blog><!----></app-root>
  <noscript>Please enable JavaScript to continue using this application.</noscript>
<script id="ScullyIO-transfer-state"></script><script src="runtime-es2015.ca8e84d8fcd730d6790d.js" type="module"></script><script src="runtime-es5.ca8e84d8fcd730d6790d.js" nomodule="" defer=""></script><script src="polyfills-es5.fd4d891648483297bc1d.js" nomodule="" defer=""></script><script src="polyfills-es2015.0acec21e36c4d574a7ba.js" type="module"></script><script src="main-es2015.f9ad1098be7033bda049.js" type="module"></script><script src="main-es5.f9ad1098be7033bda049.js" nomodule="" defer=""></script>

</body></html>