<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Scully 1.1.0">
  <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118442837-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-118442837-2');
  </script>
  <meta charset="utf-8">
  <title>Messaging between Service Worker and Angular component</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
  <link rel="manifest" href="manifest.json">  
  <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">
  <meta name="theme-color" content="#1976d2">
<style>*,*:before,*:after{box-sizing:border-box}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}body{font-family:inherit;line-height:inherit}*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}*{--tw-shadow:0 0 #0000}*{--tw-ring-inset:var(--tw-empty, );--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59, 130, 246, .5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}</style><link rel="stylesheet" href="styles.99153653a714e7fa.css" media="all" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles.99153653a714e7fa.css"></noscript><style></style><style>ol[_ngcontent-qvc-c9]{list-style-type:decimal}ul[_ngcontent-qvc-c9]{list-style-type:disc;padding-left:2.5rem}p[_ngcontent-qvc-c9]{padding-top:1.25rem;padding-bottom:1.25rem}h2[_ngcontent-qvc-c9]{font-size:1.875rem;line-height:2.25rem;margin-top:1.25rem;margin-bottom:1.25rem}h3[_ngcontent-qvc-c9]{font-size:1.5rem;line-height:2rem;margin-top:.75rem;margin-bottom:.75rem}pre[_ngcontent-qvc-c9]{font-size:1rem;line-height:1.5rem;margin-bottom:1.25rem;padding:1.25rem}a[_ngcontent-qvc-c9]{--tw-border-opacity: 1;border-color:rgba(37,99,235,var(--tw-border-opacity));border-bottom-width:2px}</style><meta name="title" content="Messaging between Service Worker and Angular component"><meta name="description" content="Most of the time service worker logic and application logic work in isolation, but there will be cases where we need to do pass messages between them. In this post we’ll see how we can do this in an angular application."><meta name="og:type" content="article"><meta name="og:url" content="/blog/messaging-between-sw-and-angular-component"><meta name="og:title" content="Messaging between Service Worker and Angular component"><meta name="og:description" content="Most of the time service worker logic and application logic work in isolation, but there will be cases where we need to do pass messages between them. In this post we’ll see how we can do this in an angular application."><meta name="og:image" content="assets/banners/32"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="/blog/messaging-between-sw-and-angular-component"><meta name="twitter:title" content="Messaging between Service Worker and Angular component"><meta name="twitter:description" content="Most of the time service worker logic and application logic work in isolation, but there will be cases where we need to do pass messages between them. In this post we’ll see how we can do this in an angular application."><meta name="twitter:image" content="assets/banners/32"><meta name="twitter:site" content="@krishnaanaril"><meta name="twitter:creator" content="@krishnaanaril"><meta name="keywords" content="Service Worker, PWA, Angular"><meta name="og:article:published_time" content="2021-05-23T00:00:00.000Z"><meta name="og:article:modified_time" content="2021-05-31T00:00:00.000Z"><meta name="og:article:author" content="Krishna Mohan A M"><meta name="og:article:section" content="Tech"><meta name="og:article:tag" content="Service Worker, PWA, Angular"><style>
      :host {
        display: none;
      }
      scully-content {
        display: none;
      }
    </style><script>window['ScullyIO']='generated';</script></head>

<body scully-version="1.1.0">
  <app-root _nghost-qvc-c7="" ng-version="13.0.2"><div _ngcontent-qvc-c7="" class="bg-gray-200 text-gray-800 dark:bg-black dark:text-gray-50"><div _ngcontent-qvc-c7="" class="container mx-auto bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50"><section _ngcontent-qvc-c7="" class="hidden lg:flex flex-row justify-center"><nav _ngcontent-qvc-c7=""><ul _ngcontent-qvc-c7="" class="lg:text-xl lg:flex lg:flex-row"><li _ngcontent-qvc-c7="" routerlinkactive="border-b-2 border-gray-700 dark:border-gray-300" class="p-3 cursor-pointer" tabindex="0">Home</li><li _ngcontent-qvc-c7="" routerlinkactive="border-b-2 border-gray-700 dark:border-gray-300" class="p-3 cursor-pointer border-b-2 border-gray-700 dark:border-gray-300" tabindex="0">Blog</li><li _ngcontent-qvc-c7="" routerlinkactive="border-b-2 border-gray-700 dark:border-gray-300" class="p-3 cursor-pointer" tabindex="0">Projects</li><li _ngcontent-qvc-c7="" routerlinkactive="border-b-2 border-gray-700 dark:border-gray-300" class="p-3 cursor-pointer" tabindex="0">About</li><!----></ul></nav></section><div _ngcontent-qvc-c7="" class="absolute lg:hidden mr-4 p-4 right-0"><button _ngcontent-qvc-c7="" aria-label="view menu items" class="p-2"><svg _ngcontent-qvc-c7="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="24px" height="24px" class="fill-current"><path _ngcontent-qvc-c7="" d="M0 0h24v24H0z" fill="none"></path><path _ngcontent-qvc-c7="" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div><!----><router-outlet _ngcontent-qvc-c7=""></router-outlet><app-blog-post _nghost-qvc-c9=""><div _ngcontent-qvc-c9="" class="container mx-auto min-h-screen bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50">
    <div _ngcontent-qvc-c9="">
        <div _ngcontent-qvc-c9="" aria-label="Blog tags/keywords" class="pt-8 flex flex-row justify-center">
            <div _ngcontent-qvc-c9="" class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full">Service Worker</div><div _ngcontent-qvc-c9="" class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full">PWA</div><div _ngcontent-qvc-c9="" class="bg-gray-300 dark:bg-gray-700 border border-gray-400 ml-2 mr-2 pb-2 pl-4 pr-4 pt-2 text-sm align-baseline rounded-full">Angular</div><!---->
        </div>
        <div _ngcontent-qvc-c9="" class="max-w-screen-lg mx-auto">
            <h1 _ngcontent-qvc-c9="" class="text-5xl pt-5 pb-5 text-center">Messaging between Service Worker and Angular component</h1>
        </div>
        <div _ngcontent-qvc-c9="" class="flex flex-row justify-center m-5 max-w-screen-sm mx-auto">
            <time _ngcontent-qvc-c9="" class="text-center text-xl">May 23, 2021</time>
        </div>
    </div>
    <hr _ngcontent-qvc-c9="" class="mx-auto border-gray-800 w-1/4">
    <div _ngcontent-qvc-c9="" class="max-w-screen-md mx-auto p-6 md:p-12 leading-8">
        <!--scullyContent-begin--><p _ngcontent-qvc-c9="">Most of the time service worker logic and application logic work in isolation, but there will be cases where we need to pass messages between them. For example we are using background sync and to let the application know that it is complete, we can send a message from service worker and receive it in the application. In this post we’ll see how we can do this in an angular application.</p>
<h2 id="prerequisite" _ngcontent-qvc-c9="">Prerequisite</h2>
<ol _ngcontent-qvc-c9="">
<li _ngcontent-qvc-c9="">   Basic understanding of Angular <a href="https://angular.io/guide/what-is-angular" _ngcontent-qvc-c9="">application architecture</a>.</li>
<li _ngcontent-qvc-c9="">   Basic understanding of <a href="https://angular.io/guide/service-worker-intro" _ngcontent-qvc-c9="">PWA</a> and service workers.</li>
<li _ngcontent-qvc-c9="">   <a href="https://code.visualstudio.com/download" _ngcontent-qvc-c9="">VS Code</a> and <a href="https://angular.io/cli#installing-angular-cli" _ngcontent-qvc-c9="">@angular/cli</a> installation.</li>
</ol>
<h2 id="basic-workflow" _ngcontent-qvc-c9="">Basic Workflow</h2>
<ul _ngcontent-qvc-c9="">
<li _ngcontent-qvc-c9="">On button click we'll create a message with property <code _ngcontent-qvc-c9="">type</code> and value <code _ngcontent-qvc-c9="">FROM_APP</code> and send it to the service worker.</li>
<li _ngcontent-qvc-c9="">In service worker we'll create a event handler to listen to messages and filter messages with type <code _ngcontent-qvc-c9="">FROM_APP</code>.</li>
<li _ngcontent-qvc-c9="">From service worker send acknowledgement message back to client with property <code _ngcontent-qvc-c9="">type</code> and value <code _ngcontent-qvc-c9="">FROM_SW</code>.</li>
<li _ngcontent-qvc-c9="">In the angular component receive the acknowledgement and print it to the console.</li>
</ul>
<h2 id="send-message-from-angular" _ngcontent-qvc-c9="">Send Message from Angular</h2>
<p _ngcontent-qvc-c9="">To send message from angular we will be using <code _ngcontent-qvc-c9="">postMessage</code> method of <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/message_event" _ngcontent-qvc-c9="">ServiceWorker</a>. <code _ngcontent-qvc-c9="">postMessage</code> signature is similar to that of <a href="https://developer.mozilla.org/en-US/docs/Web/API/Client/postMessage" _ngcontent-qvc-c9="">Client.postMessage</a>. Unfortunately I couldn't find its documentation in the MDN site.</p>
<pre _ngcontent-qvc-c9=""><code class="language-typescript" _ngcontent-qvc-c9="">navigator.serviceWorker.controller.postMessage({
    type: 'FROM_APP'
});
</code></pre>
<h2 id="create-event-handler-to-accept-message-from-service-worker" _ngcontent-qvc-c9="">Create event handler to accept message from service worker.</h2>
<p _ngcontent-qvc-c9="">Here we'll be adding the handler to <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/message_event" _ngcontent-qvc-c9="">ServicWorkerContainer</a> <code _ngcontent-qvc-c9="">message</code> event.</p>
<pre _ngcontent-qvc-c9=""><code class="language-typescript" _ngcontent-qvc-c9="">navigator.serviceWorker.onmessage = (event)=&gt;{
    if(event.data &amp;&amp; event.data.type === 'FROM_SW') {
        console.log('Message received from SW');
    }
}
</code></pre>
<h2 id="receive-message-in-service-worker" _ngcontent-qvc-c9="">Receive message in service worker</h2>
<p _ngcontent-qvc-c9="">In service worker we can create an event handler to the message event that will filter messages with type <code _ngcontent-qvc-c9="">FROM_APP</code>.</p>
<pre _ngcontent-qvc-c9=""><code class="language-typescript" _ngcontent-qvc-c9="">self.addEventListener('message', (event) =&gt; {
    if (event.data &amp;&amp; event.data.type === 'FROM_APP') {
        console.log('message received from app');                   
    }
});
</code></pre>
<h2 id="send-acknowledge-to-the-parent-page" _ngcontent-qvc-c9="">Send acknowledge to the parent page</h2>
<p _ngcontent-qvc-c9="">To send acknowledge message we need to identify the last focused tab. We can use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Clients/matchAll" _ngcontent-qvc-c9="">matchAll</a> method for that. This method (Chrome 46/Firefox 54 and later) returns clients in most recently focused order.</p>
<pre _ngcontent-qvc-c9=""><code class="language-typescript" _ngcontent-qvc-c9="">self.clients.matchAll().then((clients) =&gt; {
    if (clients &amp;&amp; clients.length) {
        //Respond to last focused tab
        clients[0].postMessage({ type: 'FROM_SW' });
    }
});
</code></pre>
<h2 id="conclusion" _ngcontent-qvc-c9="">Conclusion</h2>
<p _ngcontent-qvc-c9="">Even though service worker communication and its implementation are easy, it is very difficult to get relevant documentation regarding events and available methods. Referring Mozilla documentation is a good start, but it is not complete.  You can also refer '<a href="https://felixgerschau.com/how-to-communicate-with-service-workers/" _ngcontent-qvc-c9="">How to communicate with Service Workers</a>' article written by <a href="https://twitter.com/4xfelix" _ngcontent-qvc-c9="">Felix Gerschau</a> for more information.</p>
<!--scullyContent-end--><scully-content _ngcontent-qvc-c9=""></scully-content>
    <script>try {window['scullyContent'] = {cssId:"_ngcontent-qvc-c9",html:document.body.innerHTML.split('<!--scullyContent-begin-->')[1].split('<!--scullyContent-end-->')[0]};} catch(e) {console.error('scully could not parse content');}</script></div>
    <hr _ngcontent-qvc-c9="" class="border-gray-800">    
</div><!----></app-blog-post><!----><footer _ngcontent-qvc-c7="" class="container mx-auto flex flex-col bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-50"><div _ngcontent-qvc-c7="" class="mt-10"><ul _ngcontent-qvc-c7="" class="flex flex-row justify-between max-w-sm mx-auto pl-4 pr-4"><li _ngcontent-qvc-c7="" class="hover:text-gray-600 dark:hover:text-gray-100"><a _ngcontent-qvc-c7="" href="https://twitter.com/KrishnaAnaril">Twitter</a></li><li _ngcontent-qvc-c7=""><a _ngcontent-qvc-c7="" href="https://krishnamohan.dev/sitemap-blog.xml">Sitemap</a></li><li _ngcontent-qvc-c7=""><a _ngcontent-qvc-c7="" href="https://krishnamohan.dev/feed.xml">RSS</a></li><li _ngcontent-qvc-c7=""><a _ngcontent-qvc-c7="" href="mailto:krishnamohan.a.m@gmail.com">Contact</a></li></ul></div><div _ngcontent-qvc-c7="" class="mx-auto p-5 text-sm"><p _ngcontent-qvc-c7="">© 2021-present <a _ngcontent-qvc-c7="" href="https://krishnamohan.dev/" class="font-bold">Krishna Mohan A M</a>. All Rights Reserved.</p></div></footer></div></app-root>
  <noscript>Please enable JavaScript to continue using this application.</noscript>
<script id="ScullyIO-transfer-state"></script><script src="runtime.f6f05bc661b6cd35.js" type="module"></script><script src="polyfills.cdeb10946e6f0075.js" type="module"></script><script src="main.2920003161189d56.js" type="module"></script>

</body></html>