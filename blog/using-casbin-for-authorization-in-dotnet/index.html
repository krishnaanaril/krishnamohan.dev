<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Scully 0.0.0">
  <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118442837-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-118442837-2');
  </script>
  <meta charset="utf-8">
  <title>Using Casbin for authorization in dotnet</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
  <link rel="manifest" href="manifest.json">  
  <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">
  <meta name="theme-color" content="#1976d2">
<link rel="stylesheet" href="styles.ebda5ec8c0c5f26dcbd1.css"><style></style><style>.cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}
</style><script charset="utf-8" src="common-es2015.e045a09f09ef3032a2b3.js"></script><script charset="utf-8" src="6-es2015.86cbc72204f27eaaf243.js"></script><style>[_ngcontent-pwi-c26]::slotted(h1){color:#330625;background-color:#f8d3ec;padding:5px;border-radius:5px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.blog-post[_ngcontent-pwi-c26], .post-footer[_ngcontent-pwi-c26]{margin:auto;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;max-width:768px;font-size:18px;line-height:1.9;font-family:Raleway,sans-serif}@media (max-width:768px){.blog-post[_ngcontent-pwi-c26], .post-footer[_ngcontent-pwi-c26]{margin:0 10px}}pre[_ngcontent-pwi-c26]{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;background-color:rgba(0,0,0,.05);padding:20px}pre[_ngcontent-pwi-c26]   code[_ngcontent-pwi-c26]{background-color:transparent}code[_ngcontent-pwi-c26]{background-color:rgba(0,0,0,.05);padding:2px 4px;white-space:break-spaces;word-break:break-word}.blog-title[_ngcontent-pwi-c26]{font-weight:400;font-size:4.5rem;line-height:1;word-break:normal;display:block;margin:0 auto 10px;text-align:center;font-family:Zilla Slab,serif}@media (max-width:768px){.blog-title[_ngcontent-pwi-c26]{font-size:3rem}}hr[_ngcontent-pwi-c26]{width:100px}.sub-items-container[_ngcontent-pwi-c26], mat-chip-list[_ngcontent-pwi-c26]{display:flex;justify-content:center}mat-chip-list[_ngcontent-pwi-c26]{margin:50px auto 5px}.keywords[_ngcontent-pwi-c26]{background-color:#f5f5f5;padding:10px;border:1px solid grey}</style><meta name="title" content="Using Casbin for authorization in dotnet"><meta name="description" content="Casbin is a powerful and efficient open-source access control library. It provides support for enforcing authorization based on various access control models. Here I'll be sharing my thoughts on Casbin.NET, an authorization library for dotnet."><meta name="og:type" content="website"><meta name="og:url" content="/blog/using-casbin-for-authorization-in-dotnet"><meta name="og:title" content="Using Casbin for authorization in dotnet"><meta name="og:description" content="Casbin is a powerful and efficient open-source access control library. It provides support for enforcing authorization based on various access control models. Here I'll be sharing my thoughts on Casbin.NET, an authorization library for dotnet."><meta name="og:image" content=""><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="/blog/using-casbin-for-authorization-in-dotnet"><meta name="twitter:title" content="Using Casbin for authorization in dotnet"><meta name="twitter:description" content="Casbin is a powerful and efficient open-source access control library. It provides support for enforcing authorization based on various access control models. Here I'll be sharing my thoughts on Casbin.NET, an authorization library for dotnet."><meta name="twitter:image" content=""><meta name="twitter:site" content="@krishnaanaril"><meta name="twitter:creator" content="@krishnaanaril"><meta name="keywords" content="casbin, abac, auth, dotnet"><style>.mat-chip{position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;transform:translateZ(0);border:none;-webkit-appearance:none;-moz-appearance:none}.mat-standard-chip{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:inline-flex;padding:7px 12px;border-radius:16px;align-items:center;cursor:default;min-height:32px;height:1px}._mat-animation-noopable.mat-standard-chip{transition:none;animation:none}.mat-standard-chip .mat-chip-remove.mat-icon{width:18px;height:18px}.mat-standard-chip::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;opacity:0;content:"";pointer-events:none;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-standard-chip:hover::after{opacity:.12}.mat-standard-chip:focus{outline:none}.mat-standard-chip:focus::after{opacity:.16}.cdk-high-contrast-active .mat-standard-chip{outline:solid 1px}.cdk-high-contrast-active .mat-standard-chip:focus{outline:dotted 2px}.mat-standard-chip.mat-chip-disabled::after{opacity:0}.mat-standard-chip.mat-chip-disabled .mat-chip-remove,.mat-standard-chip.mat-chip-disabled .mat-chip-trailing-icon{cursor:default}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar,.mat-standard-chip.mat-chip-with-avatar{padding-top:0;padding-bottom:0}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-right:8px;padding-left:0}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-left:8px;padding-right:0}.mat-standard-chip.mat-chip-with-trailing-icon{padding-top:7px;padding-bottom:7px;padding-right:8px;padding-left:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon{padding-left:8px;padding-right:12px}.mat-standard-chip.mat-chip-with-avatar{padding-left:0;padding-right:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-avatar{padding-right:0;padding-left:12px}.mat-standard-chip .mat-chip-avatar{width:24px;height:24px;margin-right:8px;margin-left:4px}[dir=rtl] .mat-standard-chip .mat-chip-avatar{margin-left:8px;margin-right:4px}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{width:18px;height:18px;cursor:pointer}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-standard-chip .mat-chip-remove,[dir=rtl] .mat-standard-chip .mat-chip-trailing-icon{margin-right:8px;margin-left:0}.mat-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit;overflow:hidden}.mat-chip-list-wrapper{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;margin:-4px}.mat-chip-list-wrapper input.mat-input-element,.mat-chip-list-wrapper .mat-standard-chip{margin:4px}.mat-chip-list-stacked .mat-chip-list-wrapper{flex-direction:column;align-items:flex-start}.mat-chip-list-stacked .mat-chip-list-wrapper .mat-standard-chip{width:100%}.mat-chip-avatar{border-radius:50%;justify-content:center;align-items:center;display:flex;overflow:hidden;object-fit:cover}input.mat-chip-input{width:150px;margin:4px;flex:1 0 150px}
</style><style>
      :host {
        display: none;
      }
      scully-content {
        display: none;
      }
    </style><script>window['ScullyIO']='generated';</script></head>

<body scully-version="0.0.0">
  <app-root _nghost-pwi-c13="" ng-version="11.0.2"><mat-toolbar _ngcontent-pwi-c13="" class="mat-toolbar tool-bar mat-toolbar-single-row"><nav _ngcontent-pwi-c13=""><ul _ngcontent-pwi-c13="" class="top-nav"><li _ngcontent-pwi-c13="" routerlink="/" routerlinkactive="nav-active" tabindex="0">Home</li><li _ngcontent-pwi-c13="">Blog</li><li _ngcontent-pwi-c13="">Projects</li><li _ngcontent-pwi-c13="">About</li></ul></nav></mat-toolbar><router-outlet _ngcontent-pwi-c13=""></router-outlet><app-blog _nghost-pwi-c26=""><div _ngcontent-pwi-c26="" class="blog-post">
    <div _ngcontent-pwi-c26="" class="title-section">
        <mat-chip-list _ngcontent-pwi-c26="" aria-label="Blog tags/keywords" class="mat-chip-list" id="mat-chip-list-0" tabindex="0" aria-required="false" aria-disabled="false" aria-invalid="false" aria-multiselectable="false" role="listbox" aria-orientation="horizontal"><div class="mat-chip-list-wrapper">
            <mat-chip _ngcontent-pwi-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>casbin</mat-chip><mat-chip _ngcontent-pwi-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>abac</mat-chip><mat-chip _ngcontent-pwi-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>auth</mat-chip><mat-chip _ngcontent-pwi-c26="" role="option" color="primary" class="mat-chip mat-focus-indicator keywords mat-primary mat-standard-chip" tabindex="-1" aria-disabled="false"><div class="mat-chip-ripple"></div>dotnet</mat-chip><!---->
        </div></mat-chip-list>
        <h1 _ngcontent-pwi-c26="" class="blog-title">Using Casbin for authorization in dotnet</h1>
        <div _ngcontent-pwi-c26="" class="sub-items-container">
            <time _ngcontent-pwi-c26="">Feb 14, 2021</time>
        </div>
    </div>
    <hr _ngcontent-pwi-c26="">
    <!--scullyContent-begin--><p _ngcontent-pwi-c26="">Our organization, as part of common platform initiative, was trying to create an authorization mechanism for multiple applications in our ecosystem. Last week as a part of this initiative I was browsing internet to find a client library that makes use of Attribute based access control (ABAC). <a href="https://github.com/topics/abac" _ngcontent-pwi-c26="">Casbin</a> is one of the most starred libraries in the topic ABAC.
So I thought of giving it a try.</p>
<p _ngcontent-pwi-c26="">The primary language for Casbin was Go, since it was developed in Go itself. But that wasn't a problem as they've already created similar libraries in java, dotnet and nodejs. I picked <a href="https://github.com/casbin/Casbin.NET" _ngcontent-pwi-c26="">Casbin.Net</a> due to my proficiency in C#. For the sake of simplicity I'm only evaluating Casbin's ABAC feature here. For full feature list please see the <a href="https://casbin.org/docs/en/supported-models" _ngcontent-pwi-c26="">official documentation</a>.</p>
<h2 id="perm-modeling-language" _ngcontent-pwi-c26="">PERM Modeling Language</h2>
<p _ngcontent-pwi-c26="">Casbin introduces a new policy language named PERM (Policy, Effect, Request and Matcher) modeling language. If interested you can learn more about it in the author's <a href="https://arxiv.org/abs/1903.09756" _ngcontent-pwi-c26="">research paper</a>.</p>
<p _ngcontent-pwi-c26=""><img src="assets/images/PERM_MetaModel.svg" alt="PERM Meta Model" _ngcontent-pwi-c26="">
<em _ngcontent-pwi-c26="">PERM Meta Model</em></p>
<h3 id="request" _ngcontent-pwi-c26="">Request</h3>
<p _ngcontent-pwi-c26="">Request is defined as key-value pair. The key is always r, while the value is a list of attributes. An access request is usually represented by the classic triple: accessing entity (sub), accessed resource (obj) and the access method (act). In this condition, we have: <code _ngcontent-pwi-c26="">attributes = sub; obj; act</code>, or in PML's grammar: <code _ngcontent-pwi-c26="">r = sub, obj, act</code>.</p>
<h3 id="policy" _ngcontent-pwi-c26="">Policy</h3>
<p _ngcontent-pwi-c26="">Policy is defined as key-value pair. The key is always p, which represents an abstract policy rule entity. The value attributes denotes the attribute names that p has. E.g.: <code _ngcontent-pwi-c26="">p = sub, obj, act</code>.</p>
<h3 id="policy-rule" _ngcontent-pwi-c26="">Policy Rule</h3>
<p _ngcontent-pwi-c26="">Policy rule is an instance of the above policy. The number of elements in the tuple will be identical with the attribute names in policy. For example, the above policy rule: <code _ngcontent-pwi-c26="">alice, data1, read</code> generates a binding to the attributes like: <code _ngcontent-pwi-c26="">p.sub = alice, p.obj = data1, p.act = read</code>.</p>
<h3 id="matcher" _ngcontent-pwi-c26="">Matcher</h3>
<p _ngcontent-pwi-c26="">Matcher determines how the policy rules are evaluated against the request. The simplest matcher is: <code _ngcontent-pwi-c26="">m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act</code> (m represents the matcher). It means the matcher returns true only if subject, object and action in the access request exactly match the respective fields in a policy rule.</p>
<h3 id="effect" _ngcontent-pwi-c26="">Effect</h3>
<p _ngcontent-pwi-c26="">The effect primitive determines whether the request should be approved if
multiple policy rules match the request. In a effect term, the <strong _ngcontent-pwi-c26="">quantifier</strong> aggregates the multiple decisions from the valid set for condition into a single boolean value. It can be 'some', 'max' or 'min'. condition functions in a similar way as matcher, but it is used for filtering valid decisions instead of matching the policy rules with the request. E.g: <code _ngcontent-pwi-c26="">e = some(where (p.eft == allow))</code></p>
<h2 id="examples" _ngcontent-pwi-c26="">Examples</h2>
<p _ngcontent-pwi-c26="">First we need to create a Casbin enforcer object which accepts two parameters in its constructor. First parameter is <a href="https://casbin.org/docs/en/supported-models" _ngcontent-pwi-c26="">Model</a> and the second one is <a href="https://casbin.org/docs/en/adapters" _ngcontent-pwi-c26="">Adapter</a>.</p>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26=""><p _ngcontent-pwi-c26="">Model</p>
<p _ngcontent-pwi-c26="">  Model is defined in a file with .conf extension. A model <code _ngcontent-pwi-c26="">CONF</code> should have at least four sections: <code _ngcontent-pwi-c26="">[request_definition], [policy_definition], [policy_effect], [matchers]</code>. If a model uses RBAC, it should also add the <code _ngcontent-pwi-c26="">[role_definition]</code> section. A model <code _ngcontent-pwi-c26="">CONF</code> can contain comments. The comments start with <code _ngcontent-pwi-c26="">#</code>, and <code _ngcontent-pwi-c26="">#</code> will comment the rest of the line.
  The matcher evaluation in Casbin is implemented by expression evaluators in each language.</p>
</li>
<li _ngcontent-pwi-c26=""><p _ngcontent-pwi-c26="">Adapter</p>
<p _ngcontent-pwi-c26="">  In Casbin, the policy storage is implemented as an adapter (aka middleware for Casbin). For full set of supported adapters refer the <a href="https://casbin.org/docs/en/adapters#supported-adapters" _ngcontent-pwi-c26="">documentation</a>. For the examples below I'm using the default file adapter, such that policy rules are defined in csv format.</p>
<h3 id="basic" _ngcontent-pwi-c26="">Basic</h3>
</li>
</ul>
<p _ngcontent-pwi-c26="">For the basic example we are just checking whether the subject, object and action attributes of both policy and request match.</p>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">basic_model.conf</li>
</ul>
<pre _ngcontent-pwi-c26=""><code _ngcontent-pwi-c26="">[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act</code></pre>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">basic_policy.csv</li>
</ul>
<pre _ngcontent-pwi-c26=""><code _ngcontent-pwi-c26="">p, alice@example.com, BasicTest, Get</code></pre>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">Verification Code</li>
</ul>
<pre _ngcontent-pwi-c26=""><code class="language-csharp" _ngcontent-pwi-c26="">var e = new Enforcer("./casbin-config/basic_model.conf", "./casbin-config/basic_policy.csv");
if (e.Enforce(sub, obj, act)) 
{
    // permit alice to read data1
    Console.WriteLine("Access Granted");
}
else
{
    // deny the request, show an error
    Console.WriteLine("Access Denied");
}    </code></pre>
<h3 id="basic-with-environment-attribute" _ngcontent-pwi-c26="">Basic with environment attribute</h3>
<p _ngcontent-pwi-c26="">Here we are passing an extra attribute to add policies on environment. User have access to only dev environment and all other requests will fail.</p>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">env_model.conf</li>
</ul>
<pre _ngcontent-pwi-c26=""><code _ngcontent-pwi-c26="">[request_definition]
r = sub, obj, act, env

[policy_definition]
p = sub, obj, act, env

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act &amp;&amp; r.env == p.env</code></pre>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">env_policy.csv</li>
</ul>
<pre _ngcontent-pwi-c26=""><code _ngcontent-pwi-c26="">p, alice@example.com, BasicTest, Get, dev</code></pre>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">Verification Code</li>
</ul>
<pre _ngcontent-pwi-c26=""><code class="language-csharp" _ngcontent-pwi-c26="">var e = new Enforcer("./casbin-config/env_model.conf", "./casbin-config/env_policy.csv");
if (e.Enforce(sub, obj, act, env)) 
{
    // permit alice to read data1
    Console.WriteLine("Access Granted");
}
else
{
    // deny the request, show an error
    Console.WriteLine("Access Denied");
}   </code></pre>
<h3 id="advanced-usage" _ngcontent-pwi-c26="">Advanced usage</h3>
<p _ngcontent-pwi-c26="">Here please note the matcher statement of the model. A function is invoked from the environment object. Unlike previous examples here the request attribute <code _ngcontent-pwi-c26="">env</code> is an object with method <code _ngcontent-pwi-c26="">IsAPAC()</code> which returns true only if the given location is in the list of APAC countries.</p>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">advanced_model.csv</li>
</ul>
<pre _ngcontent-pwi-c26=""><code _ngcontent-pwi-c26="">[request_definition]
r = sub, obj, act, env

[policy_definition]
p = sub, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act &amp;&amp; r.env.IsAPAC()</code></pre>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">advanced_policy.csv</li>
</ul>
<pre _ngcontent-pwi-c26=""><code _ngcontent-pwi-c26="">p, alice@example.com, BasicTest, Get</code></pre>
<ul _ngcontent-pwi-c26="">
<li _ngcontent-pwi-c26="">Verification Code</li>
</ul>
<pre _ngcontent-pwi-c26=""><code class="language-csharp" _ngcontent-pwi-c26="">public class Environment {
    private string _location;
    private string[] APAC_COUNTRIES = {"India", "UAE", "Srilanka"};
    public Environment(string location)
    {
        _location = location;
    }
    public bool IsAPAC() {
        return Array.Exists(APAC_COUNTRIES, element =&gt; element == _location);
    }
}

/*
* Some lines of code
*/

var e = new Enforcer("./casbin-config/advanced_model.conf", "./casbin-config/advanced_policy.csv");
Environment env = new Environment(location);
if (e.Enforce(sub, obj, act, env)) 
{
    // permit alice to read data1
    Console.WriteLine("Access Granted");
}
else
{
    // deny the request, show an error
    Console.WriteLine("Access Denied");
}  </code></pre>
<h2 id="final-thoughts" _ngcontent-pwi-c26="">Final Thoughts</h2>
<p _ngcontent-pwi-c26="">I'm impressed with the documentation and ease of use of Casbin library. But I'm bit skeptical about its performance in real production environments. To gather some opinions I asked this question in <a href="https://news.ycombinator.com/item?id=26112460" _ngcontent-pwi-c26="">Hacker News</a>, but unfortunately I got reply only from the library's author himself. I had a discussion with our senior architect, who recommended to use the standard <code _ngcontent-pwi-c26="">XACML</code> for which only some java libraries are available. As a next step, I need to check some libraries based on XACML.</p>
<!--scullyContent-end--><script>try {window['scullyContent'] = {cssId:"_ngcontent-pwi-c26",html:document.body.innerHTML.split('<!--scullyContent-begin-->')[1].split('<!--scullyContent-end-->')[0]};} catch(e) {console.error('scully could not parse content');}</script><scully-content _ngcontent-pwi-c26=""></scully-content>
    <hr _ngcontent-pwi-c26="">
    <div _ngcontent-pwi-c26="" class="post-footer">
        Have questions/comments? Tweet @<a _ngcontent-pwi-c26="" href="https://twitter.com/krishnaanaril">krishnaanaril</a>
    </div>
</div><!----></app-blog><!----></app-root>
  <noscript>Please enable JavaScript to continue using this application.</noscript>
<script id="ScullyIO-transfer-state"></script><script src="runtime-es2015.ccc378816b883e572804.js" type="module"></script><script src="runtime-es5.ccc378816b883e572804.js" nomodule="" defer=""></script><script src="polyfills-es5.fd4d891648483297bc1d.js" nomodule="" defer=""></script><script src="polyfills-es2015.0acec21e36c4d574a7ba.js" type="module"></script><script src="main-es2015.d6fa01db30794654bc1c.js" type="module"></script><script src="main-es5.d6fa01db30794654bc1c.js" nomodule="" defer=""></script>

</body></html>